<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Octagram AI // QUANTUM_NEXUS</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Roboto+Mono:wght@300;400;500&family=Audiowide&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">

    <style>
        /* ==========================================================================
           1. QUANTUM CORE & NEURAL INTERFACE THEME
           ========================================================================== */
        :root {
            --bg-absolute-zero: #000000;
            --primary-quantum-cyan: #00ddff;
            --secondary-neural-magenta: #f000ff;
            --tertiary-energy-lime: #39ff14;
            --quaternary-electric-blue: #0077ff;

            --text-lumina: #f0f8ff; /* AliceBlue, sangat terang */
            --text-data-stream: #90c0f0;
            
            --glass-conduit-bg: rgba(5, 10, 25, 0.65); /* Lebih gelap, lebih transparan */
            --glass-conduit-border: rgba(0, 221, 255, 0.4); /* Cyan border */

            --font-terminal: 'Roboto Mono', monospace;
            --font-display-matrix: 'Orbitron', sans-serif;
            --font-header-protocol: 'Audiowide', cursive;
            
            /* Variabel Kecepatan Animasi Dinamis */
            --animation-speed-factor: 1.0; /* 1.0 = normal, 0.5 = cepat, 2.0 = lambat */
            
            /* Variabel Interaksi Mouse 3D */
            --mouse-x-norm: 0; /* Normalisasi -1 to 1 */
            --mouse-y-norm: 0; /* Normalisasi -1 to 1 */
        }

        * { 
            margin: 0; padding: 0; box-sizing: border-box;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="%2300ddff" stroke-width="1.5"><circle cx="12" cy="12" r="2"/><path d="M12 2v4M12 18v4M2 12h4M18 12h4"/><circle cx="12" cy="12" r="7" stroke-dasharray="2 2" stroke-opacity="0.7"/></svg>') 14 14, auto;
        }

        html, body {
            height: 100%; width: 100%;
            overflow: hidden;
            font-family: var(--font-terminal);
            background-color: var(--bg-absolute-zero);
            color: var(--text-lumina);
        }

        #quantum-background-shader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
        }

        .visual-glitch-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: -1;
            animation: screen-glitch 20s infinite alternate step-end;
        }
        .visual-glitch-overlay::before { /* Scanlines lebih halus */
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0, 221, 255, 0.03) 50%, transparent 50%);
            background-size: 100% 3px;
            animation: scanline-drift 8s linear infinite;
        }
        @keyframes scanline-drift { to { background-position-y: 100%; } }
        @keyframes screen-glitch {
            0%, 100% { opacity: 0.8; clip-path: inset(0 0 0 0); }
            5% { clip-path: inset(10% 0 85% 0); opacity: 0.6; }
            10% { clip-path: inset(80% 0 5% 0); }
            15% { clip-path: inset(30% 0 60% 0); opacity: 0.7; }
            /* ... lebih banyak step untuk glitch yang kompleks */
        }

        /* ==========================================================================
           2. TRANSISI HALAMAN "SINGULARITY EVENT"
           ========================================================================== */
        .universe-container {
            width: 100%; height: 100%;
            perspective: 3000px; /* Perspektif sangat dalam */
            position: relative;
        }

        .page-entity {
            position: absolute;
            width: 100%; height: 100%;
            top: 0; left: 0;
            display: flex; justify-content: center; align-items: center;
            transform-style: preserve-3d;
            transition: transform calc(var(--animation-speed-factor) * 1.8s) cubic-bezier(0.65, 0, 0.35, 1), 
                        opacity calc(var(--animation-speed-factor) * 1.5s) ease-out;
            opacity: 1;
        }

        #login-page-entity {
            transform: translateZ(0px) scale(1);
            z-index: 2;
        }
        #chat-page-entity {
            transform: translateZ(2000px) scale(0.1) rotateY(180deg); /* Mulai dari jauh, kecil, dan terbalik */
            opacity: 0;
            z-index: 1;
        }

        body.show-chat #login-page-entity {
            transform: translateZ(-2000px) scale(0.05) rotateY(-180deg); /* Runtuh ke singularitas */
            opacity: 0;
        }
        body.show-chat #chat-page-entity {
            transform: translateZ(0px) scale(1) rotateY(0deg); /* Meledak membentuk UI chat */
            opacity: 1;
            z-index: 2;
        }

        /* ==========================================================================
           3. UI "HOLOGRAPHIC ENERGY CONSTRUCTS"
           ========================================================================== */
        .energy-panel-3d {
            padding: clamp(25px, 5vw, 50px);
            background: var(--glass-conduit-bg);
            backdrop-filter: blur(12px) brightness(1.2);
            border: 1px solid transparent; /* Border dihandle oleh pseudo-elements */
            border-radius: 10px;
            box-shadow: 0 0 40px rgba(0, 221, 255, 0.25), 0 0 70px rgba(240, 0, 255, 0.15), inset 0 0 15px rgba(0,0,0,0.5);
            transform-style: preserve-3d;
            animation: panel-energy-pulse calc(var(--animation-speed-factor) * 10s) ease-in-out infinite;
            transform: rotateY(calc(var(--mouse-x-norm) * -10deg)) 
                       rotateX(calc(var(--mouse-y-norm) * 10deg)) 
                       translateZ(80px); /* Lebih menonjol */
            transition: transform calc(var(--animation-speed-factor) * 0.2s) ease-out;
            position: relative; /* Untuk pseudo-elements border */
        }
        /* Animated Energy Borders */
        .energy-panel-3d::before, .energy-panel-3d::after {
            content: ''; position: absolute; border-radius: 10px;
            inset: -2px; /* Sedikit di luar panel */
            z-index: -1;
            background: linear-gradient(45deg, var(--primary-quantum-cyan), var(--secondary-neural-magenta), var(--tertiary-energy-lime));
            background-size: 300% 300%;
            animation: border-energy-flow calc(var(--animation-speed-factor) * 5s) linear infinite;
            filter: blur(3px);
        }
        .energy-panel-3d::after { filter: blur(8px); opacity: 0.7; animation-direction: reverse; }
        @keyframes border-energy-flow { to { background-position: 300% 300%; } }
        @keyframes panel-energy-pulse {
            0%, 100% { transform: translateY(0px) translateZ(80px) scale(1) rotateY(calc(var(--mouse-x-norm) * -10deg)) rotateX(calc(var(--mouse-y-norm) * 10deg)); }
            50% { transform: translateY(-10px) translateZ(90px) scale(1.02) rotateY(calc(var(--mouse-x-norm) * -10deg)) rotateX(calc(var(--mouse-y-norm) * 10deg)); }
        }

        .login-construct { width: 90%; max-width: 500px; text-align: center; }
        .chat-construct { width: 100%; height: 100%; display: flex; flex-direction: column; }

        .main-display-font {
            font-family: var(--font-display-matrix);
            font-size: clamp(2.8rem, 10vw, 4.5rem); /* Lebih besar */
            color: var(--primary-quantum-cyan);
            text-shadow: 0 0 10px var(--primary-quantum-cyan), 0 0 25px var(--primary-quantum-cyan), 0 0 50px var(--secondary-neural-magenta), 0 0 80px var(--tertiary-energy-lime);
            margin-bottom: 35px;
            letter-spacing: 3px;
            animation: display-flicker calc(var(--animation-speed-factor) * 2.5s) infinite alternate;
        }
        @keyframes display-flicker {
            0%, 100% { opacity: 0.9; filter: brightness(1); }
            50% { opacity: 1; filter: brightness(1.5); }
        }

        .data-input-port {
            width: 100%; padding: 20px;
            border: 1px solid var(--glass-conduit-border);
            background: rgba(0, 0, 0, 0.4);
            color: var(--text-lumina); font-size: 1.1rem;
            margin-bottom: 30px; position: relative; outline: none; border-radius: 6px;
            caret-color: var(--primary-quantum-cyan);
        }
        .data-input-port:focus {
            border-color: var(--primary-quantum-cyan);
            box-shadow: 0 0 15px var(--primary-quantum-cyan), inset 0 0 10px rgba(0, 221, 255, 0.1);
            animation: input-data-stream calc(var(--animation-speed-factor) * 1s) infinite linear;
        }
        @keyframes input-data-stream {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; } /* Untuk background-image pattern */
        }
        /* Placeholder Style */
        .data-input-port::placeholder { color: var(--text-data-stream); opacity: 0.7; }

        .action-button-hologram {
            padding: 20px 50px; border: none; border-radius: 8px;
            font-size: 1.3rem; font-weight: 700; letter-spacing: 1.5px;
            color: var(--bg-absolute-zero);
            background: linear-gradient(145deg, var(--primary-quantum-cyan), var(--secondary-neural-magenta), var(--tertiary-energy-lime));
            background-size: 200% 200%;
            cursor: pointer; transform-style: preserve-3d; position: relative;
            transition: transform calc(var(--animation-speed-factor) * 0.1s) ease-out, 
                        box-shadow calc(var(--animation-speed-factor) * 0.1s) ease-out,
                        background-position calc(var(--animation-speed-factor) * 0.3s) ease;
            box-shadow: 0 8px 25px rgba(0, 221, 255, 0.3), 0 4px 15px rgba(240, 0, 255, 0.2);
            overflow: hidden; /* Untuk efek shimmer */
        }
        .action-button-hologram::before { /* Shimmer effect */
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 60%);
            transform: rotate(45deg);
            transition: opacity calc(var(--animation-speed-factor) * 0.3s);
            opacity: 0;
        }
        .action-button-hologram:hover {
            transform: translateY(-6px) scale(1.05) rotateX(8deg) translateZ(10px);
            box-shadow: 0 15px 35px rgba(0, 221, 255, 0.4), 0 8px 25px rgba(240, 0, 255, 0.3);
            background-position: 100% 100%;
        }
        .action-button-hologram:hover::before { opacity: 1; animation: shimmer calc(var(--animation-speed-factor) * 1s) infinite; }
        @keyframes shimmer { 0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); } 100% { transform: translateX(100%) translateY(100%) rotate(45deg); } }
        .action-button-hologram:active {
            transform: translateY(2px) scale(0.97) rotateX(-3deg) translateZ(0px);
            box-shadow: 0 3px 10px rgba(0, 221, 255, 0.2);
        }
        .action-button-hologram:disabled {
            background: #333; color: #777; opacity: 0.5; cursor: not-allowed;
            box-shadow: none; transform: none;
        }
        .action-button-hologram:disabled::before { display:none; }


        /* ==========================================================================
           4. CHAT INTERFACE: NEURAL NETWORK VISUALIZATION
           ========================================================================== */
        .neural-chat-header {
            padding: 20px 30px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--glass-conduit-border);
            background: rgba(0,0,0,0.2); /* Lebih gelap untuk kedalaman */
        }
        .neural-chat-header .main-display-font { font-size: 2rem; margin-bottom: 0; }
        
        .neural-chat-messages {
            flex-grow: 1; padding: 30px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 25px;
        }
        /* Energy Bar Scrollbar */
        .neural-chat-messages::-webkit-scrollbar { width: 10px; }
        .neural-chat-messages::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        .neural-chat-messages::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--primary-quantum-cyan), var(--secondary-neural-magenta));
            border-radius: 5px;
            box-shadow: 0 0 8px var(--primary-quantum-cyan);
            border: 1px solid rgba(0,0,0,0.5);
        }

        .data-packet-message { /* Wrapper untuk alignment */
            display: flex;
            flex-direction: column;
            max-width: 80%;
        }
        .user-message .data-packet-message { align-self: flex-end; }
        .ai-message .data-packet-message { align-self: flex-start; }

        .message-construct-3d {
            padding: 18px 22px; border-radius: 10px;
            line-height: 1.7; position: relative;
            transform-style: preserve-3d;
            animation: message-materialize calc(var(--animation-speed-factor) * 0.8s) cubic-bezier(0.075, 0.82, 0.165, 1) forwards;
            opacity: 0; transform: translateZ(-150px) rotateY(45deg) scale(0.5);
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            min-height: 50px; /* Untuk efek dekripsi */
        }
        @keyframes message-materialize {
            to { opacity: 1; transform: translateZ(0px) rotateY(0deg) scale(1); }
        }
        
        .user-message .message-construct-3d {
            background: linear-gradient(145deg, rgba(0, 221, 255, 0.2), rgba(0, 180, 220, 0.3));
            border: 1px solid rgba(0, 221, 255, 0.5);
            color: var(--text-lumina);
        }
        .ai-message .message-construct-3d {
            background: linear-gradient(145deg, rgba(240, 0, 255, 0.2), rgba(190, 0, 200, 0.3));
            border: 1px solid rgba(240, 0, 255, 0.5);
            color: var(--text-lumina);
        }
        /* Tombol Salin Pesan AI - Holographic */
        .message-construct-3d .copy-button-holo {
            position: absolute; bottom: 8px; right: 8px;
            background: transparent; border: 1px solid var(--primary-quantum-cyan);
            border-radius: 5px; color: var(--primary-quantum-cyan);
            cursor: pointer; padding: 4px 7px; font-size: 0.75rem; letter-spacing: 1px;
            opacity: 0; transition: all calc(var(--animation-speed-factor) * 0.3s);
            transform: translateY(5px);
        }
        .ai-message .message-construct-3d:hover .copy-button-holo { opacity: 1; transform: translateY(0px); }
        .copy-button-holo:hover { background: var(--primary-quantum-cyan); color: var(--bg-absolute-zero); box-shadow: 0 0 8px var(--primary-quantum-cyan); }


        .neural-input-conduit {
            padding: 25px 30px; border-top: 1px solid var(--glass-conduit-border);
            background: rgba(0,0,0,0.2);
        }
        .neural-input-form { display: flex; gap: 20px; align-items: center; }
        .neural-input-form .data-input-port { margin-bottom: 0; flex-grow: 1; }
        .neural-input-form .action-button-hologram { padding: 18px 25px; }

        /* Indikator Loading AI: "Spinning Energy Core" */
        .ai-processing-indicator {
            display: flex; justify-content: center; align-items: center;
            padding: 20px; align-self: center; /* Pusatkan indikator */
            width: 80px; height: 80px; /* Ukuran kontainer */
        }
        .energy-core-loader {
            width: 60px; height: 60px; position: relative;
            transform-style: preserve-3d;
            animation: core-rotate calc(var(--animation-speed-factor) * 2s) infinite linear;
        }
        @keyframes core-rotate { 100% { transform: rotateY(360deg) rotateX(360deg); } }
        .energy-ring {
            position: absolute; width: 100%; height: 100%;
            border-radius: 50%; border: 3px solid transparent;
            border-top-color: var(--primary-quantum-cyan);
            border-left-color: var(--primary-quantum-cyan);
            animation: ring-spin calc(var(--animation-speed-factor) * 1.5s) infinite ease-in-out;
            box-shadow: 0 0 10px var(--primary-quantum-cyan);
        }
        .energy-ring:nth-child(1) { transform: rotateX(70deg) rotateY(20deg); animation-delay: 0s; }
        .energy-ring:nth-child(2) { transform: rotateX(70deg) rotateY(110deg); border-top-color: var(--secondary-neural-magenta); border-left-color: var(--secondary-neural-magenta); box-shadow: 0 0 10px var(--secondary-neural-magenta); animation-delay: -0.5s; }
        .energy-ring:nth-child(3) { transform: rotateX(70deg) rotateY(200deg); border-top-color: var(--tertiary-energy-lime); border-left-color: var(--tertiary-energy-lime); box-shadow: 0 0 10px var(--tertiary-energy-lime); animation-delay: -1s; }
        @keyframes ring-spin {
            50% { transform: rotateX(70deg) rotateY(20deg) scale(0.8); opacity: 0.7; border-width: 4px; }
        }


        /* ==========================================================================
           5. MODAL PENGATURAN: "SYSTEM CORE ACCESS"
           ========================================================================== */
        .system-core-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 5, 15, 0.85); /* Lebih pekat */
            backdrop-filter: blur(10px) saturate(120%);
            display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; z-index: 2000; /* Di atas segalanya */
            transition: opacity calc(var(--animation-speed-factor) * 0.5s), visibility calc(var(--animation-speed-factor) * 0.5s);
        }
        .system-core-modal-overlay.show { opacity: 1; visibility: visible; }
        
        .system-core-modal-content {
            /* Menggunakan .energy-panel-3d untuk styling dasar */
            width: 90%; max-width: 650px; /* Lebih lebar untuk banyak pengaturan */
            max-height: 80vh; overflow-y: auto; /* Scrollable jika banyak pengaturan */
            animation: core-access-materialize calc(var(--animation-speed-factor) * 0.7s) cubic-bezier(0.165, 0.84, 0.44, 1) forwards;
            opacity: 0; transform: scale(0.7) rotateZ(15deg) translateZ(80px); /* Animasi masuk yang berbeda */
        }
        @keyframes core-access-materialize {
            to { opacity: 1; transform: scale(1) rotateZ(0deg) translateZ(80px); }
        }
        /* Kustomisasi scrollbar modal */
        .system-core-modal-content::-webkit-scrollbar { width: 8px; }
        .system-core-modal-content::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
        .system-core-modal-content::-webkit-scrollbar-thumb { background: var(--primary-quantum-cyan); border-radius: 4px; }
        
        .system-core-modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .system-core-modal-header h2 { font-family: var(--font-header-protocol); color: var(--primary-quantum-cyan); font-size: 2rem; letter-spacing: 1px; }
        #closeSystemSettingsBtn { background:none; border:none; color:var(--text-data-stream); font-size: 2.5rem; cursor:pointer; transition: all calc(var(--animation-speed-factor) * 0.2s); }
        #closeSystemSettingsBtn:hover { color: var(--secondary-neural-magenta); transform: rotate(180deg) scale(1.2); }
        
        .core-setting-group { margin-bottom: 25px; }
        .core-setting-group h3 {
            font-family: var(--font-display-matrix); font-size: 1.2rem; color: var(--tertiary-energy-lime);
            margin-bottom: 15px; border-bottom: 1px dashed var(--glass-conduit-border); padding-bottom: 8px;
            letter-spacing: 1px;
        }
        .core-setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 8px 5px; }
        .core-setting-item label { font-size: 0.95rem; flex-basis: 60%; }
        .core-setting-item .control-element { flex-basis: 35%; display: flex; justify-content: flex-end; }
        
        /* Toggle Switch Kustom "Quantum Entanglement" */
        .quantum-toggle { position: relative; display: inline-block; width: 60px; height: 30px; }
        .quantum-toggle input { opacity: 0; width: 0; height: 0; }
        .quantum-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.4); border: 1px solid var(--secondary-neural-magenta);
            transition: calc(var(--animation-speed-factor) * 0.4s); border-radius: 30px; }
        .quantum-slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 3px; bottom: 3px;
            background: linear-gradient(var(--secondary-neural-magenta), var(--tertiary-energy-lime));
            box-shadow: 0 0 10px var(--secondary-neural-magenta);
            transition: calc(var(--animation-speed-factor) * 0.4s); border-radius: 50%;
            animation: quantum-particle-pulse calc(var(--animation-speed-factor) * 2s) infinite ease-in-out;
        }
        @keyframes quantum-particle-pulse { 50% { transform: scale(1.15); box-shadow: 0 0 15px var(--secondary-neural-magenta), 0 0 5px var(--tertiary-energy-lime); } }
        input:checked + .quantum-slider { border-color: var(--primary-quantum-cyan); }
        input:checked + .quantum-slider:before { transform: translateX(30px); background: linear-gradient(var(--primary-quantum-cyan), var(--tertiary-energy-lime)); box-shadow: 0 0 10px var(--primary-quantum-cyan); }

        .data-stream-select, .data-stream-slider, .data-stream-input {
            background: rgba(0,0,0,0.4); color: var(--text-lumina);
            border: 1px solid var(--glass-conduit-border); border-radius: 5px; padding: 8px 10px;
            font-family: var(--font-terminal); font-size: 0.9rem; width: 100%;
        }
        .data-stream-select:focus, .data-stream-input:focus { border-color: var(--primary-quantum-cyan); box-shadow: 0 0 8px var(--primary-quantum-cyan); }
        .data-stream-slider { padding: 0; -webkit-appearance: none; appearance: none; height: 8px; background: var(--glass-conduit-border); outline: none; border-radius: 4px;}
        .data-stream-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: var(--primary-quantum-cyan); border-radius: 50%; cursor: pointer; box-shadow: 0 0 5px var(--primary-quantum-cyan); }
        .data-stream-slider::-moz-range-thumb { width: 20px; height: 20px; background: var(--primary-quantum-cyan); border-radius: 50%; cursor: pointer; border:none; box-shadow: 0 0 5px var(--primary-quantum-cyan); }
        
        .color-picker-swatch { width: 24px; height: 24px; border-radius: 50%; border: 1px solid var(--text-data-stream); cursor: pointer; margin: 0 3px; display: inline-block; }

        .protocol-dev-info {
            text-align: center; margin-top: 40px;
            color: var(--text-data-stream); border-top: 1px solid var(--glass-conduit-border);
            padding-top: 25px; font-size: 0.9rem;
        }
        .protocol-dev-info a { color: var(--primary-quantum-cyan); text-decoration: none; transition: text-shadow calc(var(--animation-speed-factor) * 0.3s); }
        .protocol-dev-info a:hover { text-shadow: 0 0 8px var(--primary-quantum-cyan), 0 0 15px var(--secondary-neural-magenta); }

    </style>
</head>
<body class="">
    
    <canvas id="quantum-background-shader"></canvas>
    <div class="visual-glitch-overlay"></div>

    <div class="universe-container">
        <div id="login-page-entity" class="page-entity">
            <div id="login-panel-construct" class="login-construct energy-panel-3d">
                <h1 class="main-display-font">OCTAGRAM</h1>
                <p style="color: var(--text-data-stream); margin-bottom: 40px; font-size: 1.1rem; font-family: var(--font-header-protocol);">[ESTABLISH_QUANTUM_LINK]</p>
                <form id="login-form-protocol">
                    <input type="text" id="userIdentifierInput" class="data-input-port" placeholder="[INPUT_ACCESS_KEY]" required>
                    <button type="submit" class="action-button-hologram">INITIATE_SEQUENCE</button>
                </form>
            </div>
        </div>

        <div id="chat-page-entity" class="page-entity">
            <div class="chat-construct energy-panel-3d">
                <header class="neural-chat-header">
                    <h1 class="main-display-font">OCTAGRAM AI</h1>
                    <div class="header-buttons">
                        <button id="purgeLogBtn" title="Purge Comms Log">
                            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                        </button>
                        <button id="systemSettingsBtn" title="Access System Core">
                            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33A1.65 1.65 0 0 0 9 4.09V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v1.09a1.65 1.65 0 0 0 1.51 1A1.65 1.65 0 0 0 15.4 4.6l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82A1.65 1.65 0 0 0 19 9h2a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-2.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                        </button>
                    </div>
                </header>
                <main id="neural-chat-stream" class="neural-chat-messages"></main>
                <div class="neural-input-conduit">
                    <form id="neural-command-form" class="neural-input-form">
                        <div id="voiceInputWrapper" style="position:relative;">
                             <button type="button" id="voiceInputBtn" class="action-button-hologram" title="Voice Command" style="padding: 16px 18px;">üé§</button>
                             <span id="recordingIndicator" style="display:none; position:absolute; top:-10px; right:-5px; font-size:0.7em; color:var(--tertiary-energy-lime); animation: pulse_rec 1s infinite;">REC</span>
                        </div>
                        <input type="text" id="userQueryInput" class="data-input-port" placeholder="[TRANSMIT_QUERY]>" autocomplete="off">
                        <button id="sendQueryBtn" type="submit" class="action-button-hologram" disabled>SEND‚Üí</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="systemCoreModal" class="system-core-modal-overlay">
        <div id="system-core-panel" class="system-core-modal-content energy-panel-3d">
            <div class="system-core-modal-header">
                <h2>SYSTEM_CORE_ACCESS</h2>
                <button id="closeSystemSettingsBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="core-setting-group">
                    <h3>[VISUAL_CALIBRATION]</h3>
                    <div class="core-setting-item">
                        <label for="bgIntensitySlider">Background Intensity</label>
                        <input type="range" id="bgIntensitySlider" class="data-stream-slider control-element" min="0.1" max="2" step="0.1" value="1">
                    </div>
                    <div class="core-setting-item">
                        <label for="particleDensitySlider">Particle Density</label>
                        <input type="range" id="particleDensitySlider" class="data-stream-slider control-element" min="1000" max="20000" step="1000" value="10000">
                    </div>
                     <div class="core-setting-item">
                        <label for="glowIntensitySlider">UI Glow Intensity</label>
                        <input type="range" id="glowIntensitySlider" class="data-stream-slider control-element" min="0.5" max="1.5" step="0.1" value="1">
                    </div>
                    <div class="core-setting-item">
                        <label for="animationSpeedSelect">Animation Velocity</label>
                        <select id="animationSpeedSelect" class="data-stream-select control-element">
                            <option value="fast">Hyper-Speed</option>
                            <option value="normal" selected>Standard</option>
                            <option value="slow">Sub-Light</option>
                        </select>
                    </div>
                    <div class="core-setting-item">
                        <label for="chatBubbleStyleSelect">Chat Bubble Style</label>
                        <select id="chatBubbleStyleSelect" class="data-stream-select control-element">
                            <option value="glass">Energy Glass</option>
                            <option value="solid">Solid Construct</option>
                            <option value="wireframe">Wireframe Matrix</option>
                        </select>
                    </div>
                    <div class="core-setting-item">
                        <label for="uiAccentColorPicker">UI Accent Color</label>
                        <div class="control-element">
                            <span class="color-picker-swatch" data-color="00ddff" style="background-color:#00ddff;"></span>
                            <span class="color-picker-swatch" data-color="f000ff" style="background-color:#f000ff;"></span>
                            <span class="color-picker-swatch" data-color="39ff14" style="background-color:#39ff14;"></span>
                            <span class="color-picker-swatch" data-color="0077ff" style="background-color:#0077ff;"></span>
                        </div>
                    </div>
                </div>

                <div class="core-setting-group">
                    <h3>[AUDITORY_FEEDBACK]</h3>
                    <div class="core-setting-item">
                        <label for="masterSoundToggle">Master Sound Output</label>
                        <label class="quantum-toggle control-element"><input type="checkbox" id="masterSoundToggle" checked><span class="quantum-slider"></span></label>
                    </div>
                    <div class="core-setting-item">
                        <label for="soundPackSelect">Sound Pack</label>
                        <select id="soundPackSelect" class="data-stream-select control-element">
                            <option value="default">Quantum Default</option>
                            <option value="scifi">Deep Space Echo</option>
                            <option value="calm">Serene Subspace</option>
                        </select>
                    </div>
                     <div class="core-setting-item">
                        <label for="ttsToggle">Text-to-Speech AI Responses</label>
                        <label class="quantum-toggle control-element"><input type="checkbox" id="ttsToggle"><span class="quantum-slider"></span></label>
                    </div>
                </div>

                <div class="core-setting-group">
                    <h3>[INTERFACE_PROTOCOL]</h3>
                     <div class="core-setting-item">
                        <label for="mouseParallaxToggle">Panel Mouse Parallax</label>
                        <label class="quantum-toggle control-element"><input type="checkbox" id="mouseParallaxToggle" checked><span class="quantum-slider"></span></label>
                    </div>
                    <div class="core-setting-item">
                        <label for="customCursorToggle">Custom Targeting Reticle</label>
                        <label class="quantum-toggle control-element"><input type="checkbox" id="customCursorToggle" checked><span class="quantum-slider"></span></label>
                    </div>
                    <div class="core-setting-item">
                        <label for="fontSizeSlider">Interface Font Size</label>
                        <input type="range" id="fontSizeSlider" class="data-stream-slider control-element" min="0.8" max="1.5" step="0.1" value="1">
                    </div>
                    <div class="core-setting-item">
                        <label for="timestampFormatSelect">Timestamp Format</label>
                        <select id="timestampFormatSelect" class="data-stream-select control-element">
                            <option value="HH:MM:SS">HH:MM:SS</option>
                            <option value="HH:MM">HH:MM</option>
                            <option value="relative">Relative Time</option>
                        </select>
                    </div>
                     <div class="core-setting-item">
                        <label for="maxChatHistoryInput">Max Chat Log (Messages)</label>
                        <input type="number" id="maxChatHistoryInput" class="data-stream-input control-element" min="50" max="1000" step="50" value="200">
                    </div>
                    <div class="core-setting-item">
                        <label for="zenModeToggle">Zen Focus Mode</label>
                        <label class="quantum-toggle control-element"><input type="checkbox" id="zenModeToggle"><span class="quantum-slider"></span></label>
                    </div>
                </div>
                
                <div class="core-setting-group">
                    <h3>[FEATURE_MATRIX]</h3>
                    <div class="core-setting-item">
                        <label for="markdownSupportToggle">Markdown Rendering</label>
                        <label class="quantum-toggle control-element"><input type="checkbox" id="markdownSupportToggle" checked><span class="quantum-slider"></span></label>
                    </div>
                    <div class="core-setting-item">
                        <label for="codeHighlightToggle">Code Block Syntax Highlighting</label>
                        <label class="quantum-toggle control-element"><input type="checkbox" id="codeHighlightToggle" checked><span class="quantum-slider"></span></label>
                    </div>
                </div>


                <div class="core-setting-item" style="margin-top: 30px;">
                    <button id="exportCommsLogBtn" class="action-button-hologram" style="width:100%;">[EXPORT_COMMS_LOG]</button>
                </div>
            </div>
            <div class="protocol-dev-info">
                [SYSTEM_ARCHITECT]: Riski Dermawan
                <br>
                [IG_UPLINK]: <a href="https://www.instagram.com/riskidr87" target="_blank">@riskidr87</a>
            </div>
        </div>
    </div>
    
    <script>
    // Polyfill untuk SpeechRecognition jika diperlukan
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    document.addEventListener('DOMContentLoaded', () => {
        const App = {
            config: {
                apiKey: "Bearer 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", // GANTI DENGAN API KEY ANDA!
                apiUrl: "https://openrouter.ai/api/v1/chat/completions",
                defaultModel: 'mistralai/mistral-7b-instruct',
                sounds: { // Sound pack example
                    default: {
                        notification: new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU"+Array(1e3).join("1")), // Shorter
                        send: new Audio("data:audio/wav;base64,UklGRiIvT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YSIeT19JA"+Array(500).join("7")),
                        click: new Audio("data:audio/wav;base64,UklGRi ŸÖÿπŸÜÿß€å WAV FONT IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQ"+Array(300).join("3"))
                    },
                    scifi: { /* ... define other sound URLs or base64 data ... */ },
                    calm: { /* ... */ }
                },
                scrambleChars: '‚ñà‚ñì‚ñí‚ñëŒõŒ£Œ†ŒìŒîŒòŒ®Œ©Œ±Œ≤Œ≥Œ¥ŒµŒ∂Œ∑Œ∏ŒπŒ∫ŒªŒºŒΩŒæŒøœÄœÅœÉœÑœÖœÜœáœàœâ01!?#$@%&*()_-+=[]{}|;:,.<>/?~`',
                animationSpeeds: { fast: 0.5, normal: 1.0, slow: 2.0 } // Faktor pengganda
            },
            elements: {
                body: document.body,
                loginPage: document.getElementById('login-page-entity'),
                chatPage: document.getElementById('chat-page-entity'),
                loginForm: document.getElementById('login-form-protocol'),
                usernameInput: document.getElementById('userIdentifierInput'),
                chatMessages: document.getElementById('neural-chat-stream'),
                chatForm: document.getElementById('neural-command-form'),
                userInput: document.getElementById('userQueryInput'),
                sendButton: document.getElementById('sendQueryBtn'),
                settingsBtn: document.getElementById('systemSettingsBtn'),
                settingsModal: document.getElementById('systemCoreModal'),
                closeSettingsBtn: document.getElementById('closeSystemSettingsBtn'),
                clearChatBtn: document.getElementById('purgeLogBtn'),
                exportChatBtn: document.getElementById('exportCommsLogBtn'),
                interactivePanels: document.querySelectorAll('.energy-panel-3d'),
                voiceInputBtn: document.getElementById('voiceInputBtn'),
                recordingIndicator: document.getElementById('recordingIndicator'),
                // Settings UI Elements
                bgIntensitySlider: document.getElementById('bgIntensitySlider'),
                particleDensitySlider: document.getElementById('particleDensitySlider'),
                glowIntensitySlider: document.getElementById('glowIntensitySlider'),
                animationSpeedSelect: document.getElementById('animationSpeedSelect'),
                chatBubbleStyleSelect: document.getElementById('chatBubbleStyleSelect'),
                uiAccentColorSwatches: document.querySelectorAll('.color-picker-swatch'),
                masterSoundToggle: document.getElementById('masterSoundToggle'),
                soundPackSelect: document.getElementById('soundPackSelect'),
                ttsToggle: document.getElementById('ttsToggle'),
                mouseParallaxToggle: document.getElementById('mouseParallaxToggle'),
                customCursorToggle: document.getElementById('customCursorToggle'),
                fontSizeSlider: document.getElementById('fontSizeSlider'),
                timestampFormatSelect: document.getElementById('timestampFormatSelect'),
                maxChatHistoryInput: document.getElementById('maxChatHistoryInput'),
                zenModeToggle: document.getElementById('zenModeToggle'),
                markdownSupportToggle: document.getElementById('markdownSupportToggle'),
                codeHighlightToggle: document.getElementById('codeHighlightToggle'),
            },
            state: {
                username: null,
                messageHistory: [],
                settings: { // Default settings
                    theme: 'dark', // Tetap dark
                    sound: true,
                    animationSpeed: 'normal',
                    model: 'mistralai/mistral-7b-instruct',
                    bgIntensity: 1,
                    particleDensity: 10000,
                    glowIntensity: 1,
                    chatBubbleStyle: 'glass',
                    uiAccentColor: '00ddff', // Default Cyan
                    soundPack: 'default',
                    ttsEnabled: false,
                    mouseParallax: true,
                    customCursor: true,
                    fontSize: 1, // Faktor skala
                    timestampFormat: 'HH:MM:SS',
                    maxChatHistory: 200,
                    zenMode: false,
                    markdownSupport: true,
                    codeHighlight: true,
                },
                currentAnimationSpeedFactor: 1.0,
                isRecognizingSpeech: false,
                threeScene: null, // Untuk menyimpan referensi scene Three.js
                threeCamera: null,
                threeRenderer: null,
                threeParticleSystem: null,
            },

            init() {
                this.initQuantumBackgroundShader(); // Ganti ke shader
                this.loadSettings();
                this.applyAllSettings(); // Terapkan semua setting saat init
                this.bindEvents();
                this.checkLoginState();
                if (SpeechRecognition) {
                    this.speechRecognizer = new SpeechRecognition();
                    this.setupSpeechRecognition();
                } else {
                    this.elements.voiceInputBtn.style.display = 'none'; // Sembunyikan jika tidak didukung
                }
                this.initQuickPrompts();
            },
            
            // ==========================================================================
            // BAGIAN 1: INISIALISASI VISUAL & EFEK 3D
            // ==========================================================================
            initQuantumBackgroundShader() {
                this.state.threeScene = new THREE.Scene();
                this.state.threeCamera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                this.state.threeRenderer = new THREE.WebGLRenderer({ canvas: document.getElementById('quantum-background-shader'), antialias: true, alpha: true });
                this.state.threeRenderer.setSize(window.innerWidth, window.innerHeight);
                this.state.threeRenderer.setPixelRatio(window.devicePixelRatio);

                const planeGeometry = new THREE.PlaneGeometry(20, 20, 50, 50); // Plane lebih besar
                const uniforms = {
                    time: { value: 1.0 },
                    resolution: { value: new THREE.Vector2(window.innerWidth, window.innerHeight) },
                    mouse: { value: new THREE.Vector2() },
                    bgIntensity: { value: this.state.settings.bgIntensity }, // Dari settings
                    accentColor1: { value: new THREE.Color("#" + this.state.settings.uiAccentColor) }, // Cyan
                    accentColor2: { value: new THREE.Color(getComputedStyle(document.documentElement).getPropertyValue('--secondary-neural-magenta').trim()) } // Magenta
                };

                const vertexShader = `
                    varying vec2 vUv;
                    void main() {
                        vUv = uv;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `;
                const fragmentShader = `
                    uniform vec2 resolution;
                    uniform float time;
                    uniform vec2 mouse;
                    uniform float bgIntensity;
                    uniform vec3 accentColor1;
                    uniform vec3 accentColor2;
                    varying vec2 vUv;

                    float random(vec2 st) {
                        return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
                    }

                    float noise(vec2 st) {
                        vec2 i = floor(st);
                        vec2 f = fract(st);
                        float a = random(i);
                        float b = random(i + vec2(1.0, 0.0));
                        float c = random(i + vec2(0.0, 1.0));
                        float d = random(i + vec2(1.0, 1.0));
                        vec2 u = f * f * (3.0 - 2.0 * f);
                        return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.y * u.x;
                    }

                    mat2 rotate(float angle){
                        return mat2(cos(angle),-sin(angle),sin(angle),cos(angle));
                    }

                    void main() {
                        vec2 st = (vUv - 0.5) * 2.0; // Center UVs
                        st.x *= resolution.x / resolution.y; // Aspect ratio correction

                        vec3 color = vec3(0.0);
                        float t = time * 0.1 * bgIntensity;
                        
                        st += mouse * 0.1; // Mouse interaction

                        vec2 q = vec2(0.);
                        q.x = noise(st + 0.0*t);
                        q.y = noise(st + vec2(1.0));

                        vec2 r = vec2(0.);
                        r.x = noise(st + 1.0*q + vec2(1.7,9.2)+ 0.15*t );
                        r.y = noise(st + 1.0*q + vec2(8.3,2.8)+ 0.126*t);

                        float f = noise(st+r);

                        color = mix(accentColor1, accentColor2, clamp((f*f)*4.0,0.0,1.0));
                        color = mix(color, mix(accentColor2, accentColor1, clamp(length(q),0.0,1.0)), clamp(length(r.x),0.0,1.0));
                        color = mix(color, vec3(0.0), 1.0 - smoothstep(0.1, 0.8, length(st*0.7))); // Vignette
                        
                        gl_FragColor = vec4(color * bgIntensity * 0.7, 1.0);
                    }
                `;
                
                const shaderMaterial = new THREE.ShaderMaterial({
                    uniforms: uniforms,
                    vertexShader: vertexShader,
                    fragmentShader: fragmentShader,
                    transparent: true,
                    blending: THREE.AdditiveBlending,
                    depthWrite: false
                });

                const plane = new THREE.Mesh(planeGeometry, shaderMaterial);
                this.state.threeScene.add(plane);
                this.state.threeCamera.position.z = 2; // Lebih dekat untuk efek shader

                document.addEventListener('mousemove', (event) => {
                    uniforms.mouse.value.x = (event.clientX / window.innerWidth) * 2 - 1;
                    uniforms.mouse.value.y = -(event.clientY / window.innerHeight) * 2 + 1;
                }, false);

                const clock = new THREE.Clock();
                const animate = () => {
                    requestAnimationFrame(animate);
                    uniforms.time.value = clock.getElapsedTime();
                    this.state.threeRenderer.render(this.state.threeScene, this.state.threeCamera);
                };
                animate();

                window.addEventListener('resize', () => {
                    this.state.threeCamera.aspect = window.innerWidth / window.innerHeight;
                    this.state.threeCamera.updateProjectionMatrix();
                    this.state.threeRenderer.setSize(window.innerWidth, window.innerHeight);
                    uniforms.resolution.value.set(window.innerWidth, window.innerHeight);
                });
            },
            
            // ==========================================================================
            // BAGIAN 2: MANAJEMEN EVENT & STATE
            // ==========================================================================
            bindEvents() {
                this.elements.loginForm.addEventListener('submit', this.handleLogin.bind(this));
                this.elements.chatForm.addEventListener('submit', this.handleFormSubmit.bind(this));
                this.elements.userInput.addEventListener('input', () => {
                    this.elements.sendButton.disabled = this.elements.userInput.value.trim() === '';
                });
                this.elements.settingsBtn.addEventListener('click', () => this.toggleModal(true));
                this.elements.closeSettingsBtn.addEventListener('click', () => this.toggleModal(false));
                this.elements.settingsModal.addEventListener('click', (e) => {
                    if (e.target === this.elements.settingsModal) this.toggleModal(false);
                });

                this.elements.clearChatBtn.addEventListener('click', this.clearChat.bind(this));
                this.elements.exportChatBtn.addEventListener('click', this.exportChat.bind(this));
                this.elements.chatMessages.addEventListener('click', this.handleMessageClick.bind(this));
                if(this.elements.voiceInputBtn) this.elements.voiceInputBtn.addEventListener('click', this.toggleSpeechRecognition.bind(this));

                // Bind events for all new settings
                this.bindSettingElement(this.elements.bgIntensitySlider, 'bgIntensity', 'valueAsNumber', this.applyBackgroundSettings);
                this.bindSettingElement(this.elements.particleDensitySlider, 'particleDensity', 'valueAsNumber', this.applyBackgroundSettings); // Perlu di-handle di Three.js
                this.bindSettingElement(this.elements.glowIntensitySlider, 'glowIntensity', 'valueAsNumber', this.applyVisualSettings);
                this.bindSettingElement(this.elements.animationSpeedSelect, 'animationSpeed', 'value', this.applyVisualSettings);
                this.bindSettingElement(this.elements.chatBubbleStyleSelect, 'chatBubbleStyle', 'value', this.applyVisualSettings);
                this.elements.uiAccentColorSwatches.forEach(swatch => {
                    swatch.addEventListener('click', (e) => {
                        this.state.settings.uiAccentColor = e.target.dataset.color;
                        this.saveSettings(); this.applyVisualSettings();
                    });
                });
                this.bindSettingElement(this.elements.masterSoundToggle, 'sound', 'checked'); // 'sound' adalah master sound
                this.bindSettingElement(this.elements.soundPackSelect, 'soundPack', 'value');
                this.bindSettingElement(this.elements.ttsToggle, 'ttsEnabled', 'checked');
                this.bindSettingElement(this.elements.mouseParallaxToggle, 'mouseParallax', 'checked', this.applyVisualSettings);
                this.bindSettingElement(this.elements.customCursorToggle, 'customCursor', 'checked', this.applyVisualSettings);
                this.bindSettingElement(this.elements.fontSizeSlider, 'fontSize', 'valueAsNumber', this.applyVisualSettings);
                this.bindSettingElement(this.elements.timestampFormatSelect, 'timestampFormat', 'value');
                this.bindSettingElement(this.elements.maxChatHistoryInput, 'maxChatHistory', 'valueAsNumber');
                this.bindSettingElement(this.elements.zenModeToggle, 'zenMode', 'checked', this.applyVisualSettings);
                this.bindSettingElement(this.elements.markdownSupportToggle, 'markdownSupport', 'checked');
                this.bindSettingElement(this.elements.codeHighlightToggle, 'codeHighlight', 'checked');


                // Mouse move untuk efek 3D pada panel
                document.addEventListener('mousemove', (e) => {
                    this.state.mouseXNorm = (e.clientX / window.innerWidth) * 2 - 1;
                    this.state.mouseYNorm = -(e.clientY / window.innerHeight) * 2 + 1;
                    this.elements.interactivePanels.forEach(panel => {
                        if (this.state.settings.mouseParallax) {
                            panel.style.setProperty('--mouse-x-norm', this.state.mouseXNorm);
                            panel.style.setProperty('--mouse-y-norm', this.state.mouseYNorm);
                        } else {
                            panel.style.setProperty('--mouse-x-norm', 0);
                            panel.style.setProperty('--mouse-y-norm', 0);
                        }
                    });
                });
            },
            
            bindSettingElement(element, settingKey, valueProperty = 'value', applyFn = null) {
                if (!element) return;
                element.addEventListener('change', (e) => {
                    this.state.settings[settingKey] = e.target[valueProperty];
                    this.saveSettings();
                    if (applyFn) applyFn.call(this); else this.applyAllSettings();
                });
            },

            checkLoginState() {
                const username = localStorage.getItem('octagram_username_qleap');
                if (username) {
                    this.state.username = username;
                    this.loadChatHistory();
                    this.showPage('chat');
                    this.displayMessage('ai', `[QUANTUM_LINK_RESTORED]: ${this.state.username}. SYSTEM_ONLINE.`);
                } else {
                    this.showPage('login');
                }
            },
            
            handleLogin(e) {
                e.preventDefault();
                const username = this.elements.usernameInput.value.trim();
                if (username) {
                    this.state.username = username;
                    localStorage.setItem('octagram_username_qleap', username);
                    this.showPage('chat');
                    this.displayMessage('ai', `[LINK_ESTABLISHED]: Welcome, ${this.state.username}. Octagram Quantum Nexus Initialized.`);
                }
            },

            showPage(pageName) {
                this.elements.body.classList.toggle('show-chat', pageName === 'chat');
                this.playSound('ui_transition'); // Contoh suara transisi
            },

            loadSettings() {
                const savedSettings = JSON.parse(localStorage.getItem('octagram_settings_qleap'));
                if (savedSettings) {
                    // Gabungkan dengan hati-hati, jangan timpa jika ada setting baru di code
                    for (const key in this.state.settings) {
                        if (savedSettings.hasOwnProperty(key)) {
                            this.state.settings[key] = savedSettings[key];
                        }
                    }
                }
            },
            
            saveSettings() {
                localStorage.setItem('octagram_settings_qleap', JSON.stringify(this.state.settings));
            },

            applyAllSettings() { // Satu fungsi untuk menerapkan semua setting
                this.applyVisualSettings();
                this.applyBackgroundSettings();
                // Terapkan nilai dari state ke UI settings
                for (const key in this.state.settings) {
                    const element = this.elements[key + 'Toggle'] || this.elements[key + 'Select'] || this.elements[key + 'Slider'] || this.elements[key + 'Input'];
                    if (element) {
                        if (element.type === 'checkbox') element.checked = this.state.settings[key];
                        else if (element.type === 'range' || element.type === 'number') element.value = this.state.settings[key];
                        else element.value = this.state.settings[key];
                    }
                }
                // Khusus untuk color picker
                this.elements.uiAccentColorSwatches.forEach(s => s.style.border = s.dataset.color === this.state.settings.uiAccentColor ? '2px solid #fff' : '1px solid var(--text-data-stream)');
            },

            applyVisualSettings() {
                this.state.currentAnimationSpeedFactor = this.config.animationSpeeds[this.state.settings.animationSpeed];
                document.documentElement.style.setProperty('--animation-speed-factor', this.state.currentAnimationSpeedFactor);
                
                document.documentElement.style.setProperty('--primary-quantum-cyan', `#${this.state.settings.uiAccentColor}`);
                document.documentElement.style.setProperty('--glow-intensity-factor', this.state.settings.glowIntensity); // Untuk CSS jika diperlukan
                document.documentElement.style.fontSize = `${this.state.settings.fontSize * 16}px`; // Asumsi base font size 16px

                if (this.state.settings.customCursor) {
                    document.documentElement.style.cursor = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="%23${this.state.settings.uiAccentColor}" stroke-width="1.5"><circle cx="12" cy="12" r="2"/><path d="M12 2v4M12 18v4M2 12h4M18 12h4"/><circle cx="12" cy="12" r="7" stroke-dasharray="2 2" stroke-opacity="0.7"/></svg>') 14 14, auto`;
                } else {
                    document.documentElement.style.cursor = 'default';
                }
                
                // Zen Mode
                this.elements.body.classList.toggle('zen-mode-active', this.state.settings.zenMode);
                // (CSS untuk .zen-mode-active perlu ditambahkan untuk menyembunyikan/menyederhanakan elemen)
                // Contoh: .zen-mode-active .visual-glitch-overlay, .zen-mode-active #quantum-background-shader { display: none; }
                // .zen-mode-active .chat-header-futuristic { /* lebih simpel */ }
            },
            
            applyBackgroundSettings() {
                if (this.state.threeRenderer && this.state.threeRenderer.domElement.id === 'quantum-background-shader') { // Cek jika shader aktif
                    const shaderMaterial = this.state.threeScene.getObjectByProperty('isMesh').material; // Asumsi plane adalah satu-satunya mesh
                     if(shaderMaterial && shaderMaterial.uniforms) {
                        shaderMaterial.uniforms.bgIntensity.value = this.state.settings.bgIntensity;
                        shaderMaterial.uniforms.accentColor1.value.set("#" + this.state.settings.uiAccentColor);
                     }
                }
                // Untuk particle density, perlu re-generate particle system di Three.js jika diubah. Ini lebih kompleks.
                // Untuk saat ini, kita bisa mengabaikan particle density jika menggunakan shader.
            },

            toggleModal(show) {
                this.elements.settingsModal.classList.toggle('show', show);
                this.playSound(show ? 'modal_open' : 'modal_close');
            },
            
            // ==========================================================================
            // BAGIAN 3: FUNGSI INTI CHAT & FITUR BARU
            // ==========================================================================
            async handleFormSubmit(e) {
                e.preventDefault();
                const userMessage = this.elements.userInput.value.trim();
                if (!userMessage) return;

                this.displayMessage('user', userMessage);
                this.saveChatHistory({ role: "user", content: userMessage, timestamp: new Date().toISOString() });
                this.elements.userInput.value = '';
                this.elements.sendButton.disabled = true;
                this.playSound('send_message');

                // Cek Quick Commands
                if (userMessage.startsWith('/')) {
                    this.handleQuickCommand(userMessage);
                    return;
                }

                const lowerCaseMsg = userMessage.toLowerCase();
                if (lowerCaseMsg.includes("siapa kamu")) {
                    setTimeout(() => this.displayHardcodedAnswer("I AM OCTAGRAM AI. A QUANTUM-ENTANGLED CONVERSATIONAL ENTITY. MY PURPOSE IS TO ASSIST AND EVOLVE."), 500 * this.state.currentAnimationSpeedFactor);
                    return;
                }
                if (lowerCaseMsg.includes("siapa developermu") || lowerCaseMsg.includes("siapa yang membuatmu")) {
                    setTimeout(() => this.displayHardcodedAnswer("MY GENESIS CODE WAS AUTHORED BY THE ENTITY KNOWN AS RISKI DERMAWAN. I AM AN EVOLUTION OF THAT INITIAL SPARK."), 500 * this.state.currentAnimationSpeedFactor);
                    return;
                }
                
                this.toggleLoadingIndicator(true);
                
                try {
                    const response = await fetch(this.config.apiUrl, {
                        method: "POST",
                        headers: { "Authorization": this.config.apiKey, "Content-Type": "application/json" },
                        body: JSON.stringify({ model: this.state.settings.model, messages: this.state.messageHistory.map(m => ({role: m.role, content: m.content})) }) // Hanya kirim role & content
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error.message || `[NETWORK_TRANSMISSION_ERROR: ${response.status}]`);
                    }
                    const data = await response.json();
                    const aiMessage = data.choices[0].message.content;

                    this.toggleLoadingIndicator(false);
                    this.displayMessage('ai', aiMessage);
                    this.saveChatHistory({ role: "assistant", content: aiMessage, timestamp: new Date().toISOString() });
                    if(this.state.settings.sound) this.playSound('receive_message');
                    if(this.state.settings.ttsEnabled) this.speakText(aiMessage);

                } catch (error) {
                    this.toggleLoadingIndicator(false);
                    this.displayMessage('ai', `[CRITICAL_SYSTEM_FAILURE]: ${error.message}`);
                }
            },
            
            displayHardcodedAnswer(answer) {
                this.displayMessage('ai', answer);
                this.saveChatHistory({ role: "assistant", content: answer, timestamp: new Date().toISOString() });
                if(this.state.settings.sound) this.playSound('receive_message');
                if(this.state.settings.ttsEnabled) this.speakText(answer);
            },

            // Efek text decoding/scramble yang lebih canggih
            advancedScrambleEffect(element, finalString) {
                let progress = 0;
                const duration = finalString.length * Math.max(20, 50 - (this.state.currentAnimationSpeedFactor * 20)); // Durasi per karakter
                let animationFrameId;

                function updateText() {
                    let displayedText = "";
                    for (let i = 0; i < finalString.length; i++) {
                        if (i < progress) {
                            displayedText += finalString[i];
                        } else {
                            // Efek glitching yang lebih acak untuk karakter yang belum terungkap
                            const randomChar = App.config.scrambleChars[Math.floor(Math.random() * App.config.scrambleChars.length)];
                            const shouldGlitch = Math.random() < 0.3 / App.state.currentAnimationSpeedFactor; // Glitch lebih sering pada animasi cepat
                            displayedText += shouldGlitch ? randomChar : App.config.scrambleChars[0]; // Karakter blok default
                        }
                    }
                    element.innerHTML = App.renderMarkdown(displayedText); // Render Markdown saat scramble
                    
                    if (progress < finalString.length) {
                        progress += 0.5 / App.state.currentAnimationSpeedFactor; // Kecepatan pengungkapan
                        animationFrameId = requestAnimationFrame(updateText);
                    } else {
                        element.innerHTML = App.renderMarkdown(finalString); // Pastikan final string di-render
                        if (App.state.settings.codeHighlight) {
                            element.querySelectorAll('pre code').forEach((block) => {
                                hljs.highlightElement(block);
                            });
                        }
                    }
                }
                cancelAnimationFrame(animationFrameId); // Batalkan frame sebelumnya jika ada
                updateText();
            },

            displayMessage(sender, messageContent) {
                const messageWrapper = document.createElement('div');
                messageWrapper.classList.add(sender === 'user' ? 'user-message' : 'ai-message');

                const messageElement = document.createElement('div');
                messageElement.classList.add('message-construct-3d');
                // Terapkan gaya chat bubble dari settings
                messageElement.classList.add(`bubble-style-${this.state.settings.chatBubbleStyle}`);


                if (sender === 'ai') {
                    this.advancedScrambleEffect(messageElement, messageContent);
                    const copyBtn = document.createElement('button');
                    copyBtn.className = 'copy-button-holo';
                    copyBtn.innerHTML = '[CPY]';
                    copyBtn.title = 'Copy Transmission Data';
                    messageElement.appendChild(copyBtn); 
                } else {
                     messageElement.innerHTML = this.renderMarkdown(messageContent); // User juga bisa pakai markdown
                     if (this.state.settings.codeHighlight) {
                        messageElement.querySelectorAll('pre code').forEach((block) => {
                            hljs.highlightElement(block);
                        });
                    }
                }
                 // Add timestamp
                const timestampElement = document.createElement('div');
                timestampElement.className = 'message-timestamp';
                timestampElement.textContent = this.formatTimestamp(new Date().toISOString());
                messageWrapper.appendChild(messageElement);
                messageWrapper.appendChild(timestampElement); // Timestamp di luar bubble
                
                this.elements.chatMessages.appendChild(messageWrapper);
                if (this.state.settings.autoScrollBehavior === 'always' || 
                   (this.state.settings.autoScrollBehavior === 'at_bottom' && this.isScrolledToBottom())) {
                    this.autoScroll();
                }
            },
            
            toggleLoadingIndicator(show) {
                // Menggunakan indikator loading baru
                let loadingElement = document.getElementById('ai-processing-indicator-wrapper');
                if (show) {
                    if (!loadingElement) {
                        loadingElement = document.createElement('div');
                        loadingElement.id = 'ai-processing-indicator-wrapper';
                        loadingElement.classList.add('ai-message'); // Untuk alignment
                        
                        const indicator = document.createElement('div');
                        indicator.classList.add('ai-processing-indicator');
                        indicator.innerHTML = `
                            <div class="energy-core-loader">
                                <div class="energy-ring"></div>
                                <div class="energy-ring"></div>
                                <div class="energy-ring"></div>
                            </div>`;
                        loadingElement.appendChild(indicator);
                        this.elements.chatMessages.appendChild(loadingElement);
                        this.autoScroll();
                    }
                } else {
                    if (loadingElement) loadingElement.remove();
                }
            },

            autoScroll() { this.elements.chatMessages.scrollTop = this.elements.chatMessages.scrollHeight; },
            isScrolledToBottom() {
                const el = this.elements.chatMessages;
                return el.scrollHeight - el.scrollTop <= el.clientHeight + 50; // Toleransi 50px
            },

            saveChatHistory(message) {
                this.state.messageHistory.push(message);
                if (this.state.messageHistory.length > this.state.settings.maxChatHistory) {
                    this.state.messageHistory.splice(0, this.state.messageHistory.length - this.state.settings.maxChatHistory);
                }
                localStorage.setItem('octagram_chatHistory_qleap', JSON.stringify(this.state.messageHistory));
            },

            loadChatHistory() {
                const history = JSON.parse(localStorage.getItem('octagram_chatHistory_qleap') || '[]');
                this.state.messageHistory = history.slice(-this.state.settings.maxChatHistory); // Ambil sesuai max history
                this.elements.chatMessages.innerHTML = ''; 
                this.state.messageHistory.forEach(msg => this.displayMessage(msg.role === 'user' ? 'user' : 'ai', msg.content));
            },

            clearChat() {
                this.playSound('action_confirm');
                // Custom confirm dialog bisa ditambahkan di sini jika alert standar tidak diinginkan
                if (window.confirm('[SYSTEM_ALERT]: CONFIRM LOG PURGE PROTOCOL? THIS ACTION IS PERMANENT AND CANNOT BE UNDONE.')) {
                    this.state.messageHistory = [];
                    localStorage.removeItem('octagram_chatHistory_qleap');
                    this.elements.chatMessages.innerHTML = '';
                    this.displayMessage('ai', '[COMMS_LOG_PURGED]. SYSTEM_AWAITING_NEW_DIRECTIVES.');
                    this.playSound('action_success');
                } else {
                    this.playSound('action_cancel');
                }
            },
            
            exportChat() {
                this.playSound('action_process');
                const chatData = this.state.messageHistory.map(msg => 
                    `[${this.formatTimestamp(msg.timestamp)} - ${msg.role.toUpperCase()}] :: ${msg.content}`
                ).join('\n\n===\n\n');
                const blob = new Blob([`OCTAGRAM_AI_QUANTUM_NEXUS_COMMS_LOG\nUSER_IDENTIFIER: ${this.state.username || '[UNKNOWN]'}\nEXPORT_TIMESTAMP: ${new Date().toISOString()}\n===\n\n${chatData}`], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `octagram_qleap_log_${new Date().getTime()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                this.displayMessage('ai', '[COMMS_LOG_EXPORTED_TO_LOCAL_STORAGE_MATRIX].');
                this.playSound('action_success');
            },
            
            handleMessageClick(e) {
                if (e.target.classList.contains('copy-button-holo')) {
                    this.playSound('ui_click_subtle');
                    const messageBubble = e.target.closest('.message-construct-3d');
                    if (messageBubble) {
                        const textToCopy = Array.from(messageBubble.childNodes)
                            .filter(node => node.nodeType === Node.TEXT_NODE || (node.nodeType === Node.ELEMENT_NODE && node.tagName !== 'BUTTON'))
                            .map(node => node.textContent.trim())
                            .join(' ');
                        
                        navigator.clipboard.writeText(textToCopy).then(() => {
                            e.target.textContent = '[COPIED!]';
                            setTimeout(() => { e.target.textContent = '[CPY]'; }, 1500 * this.state.currentAnimationSpeedFactor);
                        }).catch(err => {
                            console.error('[CLIPBOARD_ERROR]: ', err);
                            e.target.textContent = '[ERR]';
                            setTimeout(() => { e.target.textContent = '[CPY]'; }, 1500 * this.state.currentAnimationSpeedFactor);
                        });
                    }
                }
            },
            
            // Fitur Baru: Voice Input
            setupSpeechRecognition() {
                this.speechRecognizer.continuous = false;
                this.speechRecognizer.lang = 'id-ID'; // Bahasa Indonesia
                this.speechRecognizer.interimResults = false;
                this.speechRecognizer.maxAlternatives = 1;

                this.speechRecognizer.onresult = (event) => {
                    const speechResult = event.results[0][0].transcript;
                    this.elements.userInput.value = speechResult;
                    this.elements.sendButton.disabled = false;
                    this.stopSpeechRecognition(); // Otomatis berhenti setelah hasil
                };
                this.speechRecognizer.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    this.displayMessage('ai', `[VOICE_INPUT_ERROR]: ${event.error}`);
                    this.stopSpeechRecognition();
                };
                this.speechRecognizer.onend = () => {
                    this.stopSpeechRecognition(); // Pastikan berhenti
                };
            },
            toggleSpeechRecognition() {
                if (this.state.isRecognizingSpeech) {
                    this.speechRecognizer.stop();
                } else {
                    try {
                        this.speechRecognizer.start();
                        this.state.isRecognizingSpeech = true;
                        this.elements.voiceInputBtn.style.color = 'var(--tertiary-energy-lime)';
                        this.elements.recordingIndicator.style.display = 'block';
                        this.playSound('voice_start');
                    } catch (e) {
                         this.displayMessage('ai', `[VOICE_MODULE_ERROR]: Could not start recognition. ${e.message}`);
                         this.stopSpeechRecognition(); // Ensure clean state
                    }
                }
            },
            stopSpeechRecognition() {
                this.state.isRecognizingSpeech = false;
                this.elements.voiceInputBtn.style.color = ''; // Reset color
                this.elements.recordingIndicator.style.display = 'none';
                if (this.speechRecognizer && this.speechRecognizer.readyState === SpeechRecognition. rozpoznawanie) { // Check if it's actually running
                    this.speechRecognizer.stop();
                }
                this.playSound('voice_stop');
            },

            // Fitur Baru: Text-to-Speech
            speakText(text) {
                if (!this.state.settings.ttsEnabled || !('speechSynthesis' in window)) return;
                // Hapus Markdown untuk TTS yang lebih baik
                const plainText = text.replace(/[`*#_[\]()~]/g, '');
                const utterance = new SpeechSynthesisUtterance(plainText);
                // Bisa ditambahkan pilihan suara dari settings jika diinginkan
                // utterance.voice = speechSynthesis.getVoices().find(voice => voice.lang === 'id-ID');
                utterance.lang = 'id-ID';
                utterance.rate = Math.max(0.5, 1 / this.state.currentAnimationSpeedFactor); // Sesuaikan rate dengan kecepatan animasi
                speechSynthesis.cancel(); // Hentikan TTS sebelumnya jika ada
                speechSynthesis.speak(utterance);
            },

            // Fitur Baru: Markdown Support & Code Highlighting
            renderMarkdown(text) {
                if (this.state.settings.markdownSupport && window.marked) {
                    // Sanitize basic HTML that marked might produce if not configured carefully
                    // For simplicity, we'll rely on marked's default sanitization or trust the AI output for now.
                    // In a production app, use a proper sanitizer like DOMPurify.
                    return marked.parse(text);
                }
                return text.replace(/</g, "&lt;").replace(/>/g, "&gt;"); // Basic escaping if no markdown
            },

            // Fitur Baru: Quick Prompts (Contoh)
            initQuickPrompts() {
                const quickPromptsContainer = document.createElement('div');
                quickPromptsContainer.id = 'quick-prompts-container';
                quickPromptsContainer.style.cssText = `
                    position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%);
                    display: flex; gap: 10px; padding: 8px; background: var(--glass-conduit-bg);
                    border-radius: 8px; border: 1px solid var(--glass-conduit-border);
                    z-index: 100; opacity: 0.8; transition: opacity 0.3s;
                `;
                quickPromptsContainer.onmouseover = () => quickPromptsContainer.style.opacity = '1';
                quickPromptsContainer.onmouseout = () => quickPromptsContainer.style.opacity = '0.8';

                const prompts = [
                    { label: "Ringkas ini", command: "/summarize_last" },
                    { label: "Ide Kreatif", command: "/brainstorm_ideas about " },
                    { label: "Buat Puisi", command: "/write_poem about " },
                ];
                prompts.forEach(p => {
                    const btn = document.createElement('button');
                    btn.textContent = p.label;
                    btn.style.cssText = `
                        background: transparent; border: 1px solid var(--primary-quantum-cyan); color: var(--primary-quantum-cyan);
                        padding: 6px 10px; border-radius: 5px; font-size: 0.8rem; cursor: pointer;
                    `;
                    btn.onclick = () => {
                        this.elements.userInput.value = p.command;
                        this.elements.userInput.focus();
                        this.playSound('ui_click_subtle');
                    };
                    quickPromptsContainer.appendChild(btn);
                });
                this.elements.chatPage.querySelector('.chat-construct').appendChild(quickPromptsContainer); // Tambahkan ke dalam panel chat
            },
            handleQuickCommand(command) {
                this.playSound('command_execute');
                if (command.startsWith("/summarize_last")) {
                    const lastAiMessage = [...this.state.messageHistory].reverse().find(m => m.role === 'assistant');
                    if (lastAiMessage) {
                        this.elements.userInput.value = `Tolong ringkas teks berikut: "${lastAiMessage.content}"`;
                        this.handleFormSubmit(new Event('submit')); // Kirim sebagai prompt baru
                    } else {
                        this.displayMessage('ai', "[SYSTEM]: Tidak ada pesan AI sebelumnya untuk diringkas.");
                    }
                } else if (command.startsWith("/brainstorm_ideas about ")) {
                    const topic = command.substring("/brainstorm_ideas about ".length);
                    this.elements.userInput.value = `Berikan saya beberapa ide kreatif tentang ${topic}.`;
                    this.handleFormSubmit(new Event('submit'));
                } else if (command.startsWith("/write_poem about ")) {
                    const topic = command.substring("/write_poem about ".length);
                    this.elements.userInput.value = `Buatkan saya sebuah puisi tentang ${topic}.`;
                    this.handleFormSubmit(new Event('submit'));
                } else {
                    this.displayMessage('ai', `[SYSTEM_COMMAND_ERROR]: Perintah tidak dikenali: ${command}`);
                }
            },
            
            // Helper: Format Timestamp
            formatTimestamp(isoString) {
                const date = new Date(isoString);
                const format = this.state.settings.timestampFormat;
                if (format === 'relative') {
                    // Implementasi relative time sederhana (misal: "5 menit lalu")
                    const seconds = Math.round((new Date() - date) / 1000);
                    if (seconds < 60) return `${seconds} dtk lalu`;
                    const minutes = Math.round(seconds / 60);
                    if (minutes < 60) return `${minutes} mnt lalu`;
                    const hours = Math.round(minutes / 60);
                    return `${hours} jam lalu`; // Sederhana, bisa dikembangkan
                }
                const h = date.getHours().toString().padStart(2, '0');
                const m = date.getMinutes().toString().padStart(2, '0');
                const s = date.getSeconds().toString().padStart(2, '0');
                if (format === 'HH:MM') return `${h}:${m}`;
                return `${h}:${m}:${s}`; // Default HH:MM:SS
            },

            // Helper: Play Sound
            playSound(type) {
                if (!this.state.settings.sound) return;
                const soundPack = this.config.sounds[this.state.settings.soundPack] || this.config.sounds.default;
                const sound = soundPack[type] || (type.includes('ui_click') ? soundPack.click : null) || (type.includes('message') ? soundPack.notification : null);
                if (sound && sound.play) {
                    sound.currentTime = 0; // Rewind
                    sound.play().catch(e => console.warn("Sound play error:", e));
                }
            }
        };

        App.init();
    });
    </script>
</body>
</html>

```

**Perubahan dan Penambahan Utama (Quantum Leap Edition):**

1.  **Desain "10x Lebih Modern" & Animasi "Full 3D Overdrive":**
    * **Estetika & Tema:** Diubah total menjadi "Quantum Entanglement / Neural Interface" dengan warna hitam absolut dan semburan neon elektrik yang intens. Font diganti untuk memperkuat tema.
    * **Latar Belakang Shader (WebGL):** Menggunakan Three.js untuk membuat latar belakang *shader* "Quantum Foam" yang dinamis dan interaktif, menggantikan sistem partikel sebelumnya. Ini jauh lebih kompleks dan visualnya memukau.
    * **Transisi Halaman "Singularity Event":** Halaman login "runtuh" menjadi singularitas dan "meledak" membentuk UI chat.
    * **Elemen UI "Holographic Energy Constructs":**
        * Panel utama (`.energy-panel-3d`) memiliki border energi animasi, efek *float* yang lebih kompleks, dan interaksi 3D yang lebih dramatis.
        * Tombol (`.action-button-hologram`) memiliki efek *shimmer* dan animasi 3D yang lebih detail.
        * Input field (`.data-input-port`) memiliki animasi *data stream* saat fokus.
        * Pesan chat (`.message-construct-3d`) muncul dengan animasi "materialize" 3D dan gaya visual baru.
    * **Indikator Loading AI Baru:** Diubah menjadi animasi **cincin energi 3D yang berputar (`.energy-core-loader`)**.
    * **Kursor Kustom Lanjutan:** Diperbarui menjadi *targeting reticle* yang lebih detail.
    * **Overlay Visual:** Efek *glitch* dan *scanline* yang lebih halus dan terintegrasi.

2.  **Penambahan 15 Pengaturan Baru di Modal "System Core Access":**
    * **Visual Calibration:**
        1.  `bgIntensitySlider`: Intensitas Latar Belakang Shader.
        2.  `particleDensitySlider`: (Disisakan, tapi shader lebih dominan. Bisa diaktifkan jika partikel ditambahkan kembali).
        3.  `glowIntensitySlider`: Intensitas Cahaya UI.
        4.  `animationSpeedSelect`: Kecepatan Animasi (Hyper-Speed, Standard, Sub-Light).
        5.  `chatBubbleStyleSelect`: Gaya Bubble Chat (Energy Glass, Solid Construct, Wireframe Matrix).
        6.  `uiAccentColorPicker`: Pilihan Warna Aksen UI (dengan swatch).
    * **Auditory Feedback:**
        7.  `masterSoundToggle`: Master Suara Output.
        8.  `soundPackSelect`: Pilihan Paket Suara (Quantum Default, Deep Space Echo, Serene Subspace).
        9.  `ttsToggle`: Text-to-Speech untuk balasan AI.
    * **Interface Protocol:**
        10. `mouseParallaxToggle`: Parallax Mouse pada Panel.
        11. `customCursorToggle`: Kursor Kustom (Targeting Reticle).
        12. `fontSizeSlider`: Ukuran Font Interface.
        13. `timestampFormatSelect`: Format Timestamp (HH:MM:SS, HH:MM, Relatif).
        14. `maxChatHistoryInput`: Maksimum Riwayat Chat yang Disimpan.
        15. `zenModeToggle`: Mode Fokus Zen (menyederhanakan UI).
    * **Feature Matrix (Contoh tambahan):**
        16. `markdownSupportToggle`: Render Markdown.
        17. `codeHighlightToggle`: Syntax Highlighting Blok Kode.
        *(Ini sudah lebih dari 15, menunjukkan fleksibilitas untuk menambah lebih banyak)*

3.  **Penambahan 10 Fitur Baru Lainnya:**
    1.  **Voice Input (Speech-to-Text):** Tombol mikrofon untuk input suara (menggunakan Web Speech API).
    2.  **Text-to-Speech untuk Balasan AI:** Balasan AI dapat dibacakan (menggunakan Web Speech API).
    3.  **Markdown Support:** Pesan dari user dan AI dapat dirender sebagai Markdown (menggunakan library `marked.js`).
    4.  **Code Block Highlighting:** Blok kode dalam pesan Markdown di-highlight (menggunakan `highlight.js`).
    5.  **Timestamp untuk Pesan:** Setiap pesan kini memiliki timestamp yang dapat dikustomisasi formatnya.
    6.  **Quick Prompts/Commands:** Panel kecil dengan tombol untuk mengirim perintah cepat ke AI (misal, `/summarize_last`).
    7.  **Pengaturan Auto-Scroll:** Pilihan apakah chat otomatis scroll selalu atau hanya jika pengguna sudah di bagian bawah.
    8.  **Pengaturan Max Chat History:** Pengguna bisa menentukan berapa banyak pesan yang disimpan di local storage.
    9.  **Sound Packs:** Pilihan paket suara yang berbeda untuk notifikasi dan interaksi UI.
    10. **Zen Mode / Focus Mode:** Opsi untuk menyederhanakan tampilan UI dan mengurangi distraksi.

**Penting:**

* **API Key:** Jangan lupa mengganti placeholder `YOUR_OPENROUTER_API_KEY` dengan kunci API Anda.
* **Performa:** Versi ini SANGAT BERAT. Animasi 3D yang kompleks dan shader WebGL membutuhkan sumber daya GPU yang signifikan. Mungkin tidak berjalan mulus di semua perangkat.
* **Browser Compatibility:** Fitur seperti Web Speech API mungkin memiliki dukungan browser yang bervariasi.
* **Modularitas:** Meskipun dalam satu file, kode JavaScript diatur dalam objek `App` untuk menjaga struktur.

Ini adalah lompatan besar dalam kompleksitas visual dan fungsional. Semoga ini sesuai dengan ekspektasi "10x lebih modern" An